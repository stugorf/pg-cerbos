apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "alert"
  schemas:
    principalSchema:
      ref: cerbos:///aml_principal.json
    resourceSchema:
      ref: cerbos:///aml_resource.json
  rules:
    # Analysts and managers can view, triage, and escalate alerts
    - actions: ["view", "triage", "escalate"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst", "aml_manager"]
    
    # Auditors can only view alerts
    - actions: ["view"]
      effect: EFFECT_ALLOW
      roles: ["auditor"]

---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "case"
  schemas:
    principalSchema:
      ref: cerbos:///aml_principal.json
    resourceSchema:
      ref: cerbos:///aml_resource.json
  rules:
    # Everyone can view cases
    - actions: ["view"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst", "aml_manager", "auditor"]
    
    # Analysts can add notes to any case
    - actions: ["add_note"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst", "aml_manager"]
    
    # Analysts can edit/close only cases assigned to them (via derived role)
    - actions: ["edit", "close"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst"]
      derivedRoles: ["case_assignee"]
    
    # Managers can always assign, edit, and close cases
    - actions: ["assign", "edit", "close"]
      effect: EFFECT_ALLOW
      roles: ["aml_manager"]

---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "transaction"
  schemas:
    principalSchema:
      ref: cerbos:///aml_principal.json
    resourceSchema:
      ref: cerbos:///aml_resource.json
  rules:
    # Analysts and managers can view and expand transaction networks
    - actions: ["view", "graph_expand"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst", "aml_manager"]

---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "customer"
  schemas:
    principalSchema:
      ref: cerbos:///aml_principal.json
    resourceSchema:
      ref: cerbos:///aml_resource.json
  rules:
    # Analysts and managers can view customer information
    - actions: ["view"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst", "aml_manager"]

---
apiVersion: api.cerbos.dev/v1
resourcePolicy:
  version: "default"
  resource: "sar"
  schemas:
    principalSchema:
      ref: cerbos:///aml_principal.json
    resourceSchema:
      ref: cerbos:///aml_resource.json
  rules:
    # Everyone can view SARs
    - actions: ["view"]
      effect: EFFECT_ALLOW
      roles: ["aml_analyst", "aml_manager", "auditor"]
    
    # Only managers can draft and submit SARs
    - actions: ["draft", "submit"]
      effect: EFFECT_ALLOW
      roles: ["aml_manager"]
